<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.21.2">
    <meta name="project" content="banking v0.1.0">
    <title>Banking.Repo â€” banking v0.1.0</title>
    <link rel="stylesheet" href="dist/html-de2388dc2f8074b0a4db.css" />
    <script src="dist/sidebar_items-c10a134d9d.js"></script>
      <script src="docs_config.js"></script>
    <script async src="dist/html-de2388dc2f8074b0a4db.js"></script>
  </head>
  <body data-type="modules">
    <script>try { if(localStorage.getItem('night-mode') === 'true') document.body.className += ' night-mode'; } catch (e) { }</script>
<div class="main">

<button class="sidebar-button sidebar-toggle">
  <span class="icon-menu" title="Collapse/expand sidebar"></span>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button">
      <span class="icon-search" aria-hidden="true"></span>
    </button>
    <button type="button" tabindex="-1" class="search-close-button">
      <span class="icon-cross" title="Cancel search"></span>
    </button>
    <label class="search-label">
      <input name="q" type="text" id="search-list" class="search-input" placeholder="Search..." aria-label="Search" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">
    <div class="sidebar-projectDetails">
      <a href="api-reference.html" class="sidebar-projectName">
banking      </a>
      <h2 class="sidebar-projectVersion">
        v0.1.0
      </h2>
    </div>
  </div>

  <ul class="sidebar-listNav">
    <li><a id="extras-list" href="#full-list">Pages</a></li>

      <li><a id="modules-list" href="#full-list">Modules</a></li>


  </ul>
  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">

      <h1>
        <small class="app-vsn">banking v0.1.0</small>
Banking.Repo      </h1>



        <section id="summary" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#summary">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
            Summary
          </h1>
  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#aggregate/4">aggregate(queryable, aggregate, field, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Calculate the given <code class="inline">aggregate</code> over the given <code class="inline">field</code>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#all/2">all(queryable, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Fetches all entries from the data store matching the given query.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#checkout/2">checkout(fun, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Checks out a connection for the duration of the function.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#child_spec/1">child_spec(opts)</a>
  </div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#config/0">config()</a>
  </div>
    <div class="summary-synopsis"><p>Returns the adapter configuration stored in the <code class="inline">:otp_app</code> environment.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#delete/2">delete(struct, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Deletes a struct using its primary key.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#delete!/2">delete!(struct, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Same as <code class="inline">c:delete/2</code> but returns the struct or raises if the changeset is invalid.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#delete_all/2">delete_all(queryable, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Deletes all entries matching the given query.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#exists?/2">exists?(queryable, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Checks if there exists an entry that matches the given query.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#get/3">get(queryable, id, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Fetches a single struct from the data store where the primary key matches the
given id.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#get!/3">get!(queryable, id, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Similar to <code class="inline">c:get/3</code> but raises <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if no record was found.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#get_by/3">get_by(queryable, clauses, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Fetches a single result from the query.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#get_by!/3">get_by!(queryable, clauses, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Similar to <code class="inline">c:get_by/3</code> but raises <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if no record was found.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#get_dynamic_repo/0">get_dynamic_repo()</a>
  </div>
    <div class="summary-synopsis"><p>Returns the atom name or pid of the current repository.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#in_transaction?/0">in_transaction?()</a>
  </div>
    <div class="summary-synopsis"><p>Returns true if the current process is inside a transaction.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#insert/2">insert(struct, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Inserts a struct defined via <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Schema.html"><code class="inline">Ecto.Schema</code></a> or a changeset.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#insert!/2">insert!(struct, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Same as <code class="inline">c:insert/2</code> but returns the struct or raises if the changeset is invalid.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#insert_all/3">insert_all(schema_or_source, entries, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Inserts all entries into the repository.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#insert_or_update/2">insert_or_update(changeset, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Inserts or updates a changeset depending on whether the struct is persisted
or not.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#insert_or_update!/2">insert_or_update!(changeset, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Same as <code class="inline">c:insert_or_update/2</code> but returns the struct or raises if the changeset
is invalid.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#load/2">load(schema_or_types, data)</a>
  </div>
    <div class="summary-synopsis"><p>Loads <code class="inline">data</code> into a struct or a map.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#one/2">one(queryable, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Fetches a single result from the query.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#one!/2">one!(queryable, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Similar to <code class="inline">c:one/2</code> but raises <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if no record was found.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#preload/3">preload(struct_or_structs_or_nil, preloads, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Preloads all associations on the given struct or structs.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#prepare_query/3">prepare_query(operation, query, opts)</a>
  </div>
    <div class="summary-synopsis"><p>A user customizable callback invoked for query-based operations.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#put_dynamic_repo/1">put_dynamic_repo(dynamic)</a>
  </div>
    <div class="summary-synopsis"><p>Sets the dynamic repository to be used in further interactions.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#query/3">query(sql, params \\ [], opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>A convenience function for SQL-based repositories that executes the given query.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#query!/3">query!(sql, params \\ [], opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>A convenience function for SQL-based repositories that executes the given query.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#rollback/1">rollback(value)</a>
  </div>
    <div class="summary-synopsis"><p>Rolls back the current transaction.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#start_link/1">start_link(opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Starts any connection pooling or supervision and return <code class="inline">{:ok, pid}</code>
or just <code class="inline">:ok</code> if nothing needs to be done.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#stop/1">stop(timeout \\ 5000)</a>
  </div>
    <div class="summary-synopsis"><p>Shuts down the repository.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#stream/2">stream(queryable, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Returns a lazy enumerable that emits all entries from the data store
matching the given query.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#to_sql/2">to_sql(operation, queryable)</a>
  </div>
    <div class="summary-synopsis"><p>A convenience function for SQL-based repositories that translates the given query to SQL.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#transaction/2">transaction(fun_or_multi, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Runs the given function or <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Multi.html"><code class="inline">Ecto.Multi</code></a> inside a transaction.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#update/2">update(struct, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Updates a changeset using its primary key.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#update!/2">update!(struct, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Same as <code class="inline">c:update/2</code> but returns the struct or raises if the changeset is invalid.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#update_all/3">update_all(queryable, updates, opts \\ [])</a>
  </div>
    <div class="summary-synopsis"><p>Updates all entries matching the given query with the given values.</p></div>
</div>
  </div>
        </section>

        <section id="functions" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#functions">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
Functions          </h1>
          <div class="functions-list">
<section class="detail" id="aggregate/4">
    <span id="aggregate/3"></span>
  <div class="detail-header">
    <a href="#aggregate/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">aggregate(queryable, aggregate, field, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Calculate the given <code class="inline">aggregate</code> over the given <code class="inline">field</code>.</p>
<p>If the query has a limit, offset or distinct set, it will be
automatically wrapped in a subquery in order to return the
proper result.</p>
<p>Any preload or select in the query will be ignored in favor of
the column being aggregated.</p>
<p>The aggregation will fail if any <code class="inline">group_by</code> field is set.</p>
<h2 id="aggregate/4-options" class="section-heading">
  <a href="#aggregate/4-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This will be applied to all <code class="inline">from</code>
and <code class="inline">join</code>s in the query that did not have a prefix previously given
either via the <code class="inline">:prefix</code> option on <code class="inline">join</code>/<code class="inline">from</code> or via <code class="inline">@schema_prefix</code>
in the schema. For more information see the &quot;Query Prefix&quot; section of the
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> documentation.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="aggregate/4-examples" class="section-heading">
  <a href="#aggregate/4-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="c1"># Returns the number of visits per blog post</span><span class="w">
</span><span class="nc">Repo</span><span class="o">.</span><span class="n">aggregate</span><span class="p" data-group-id="0341197867-1">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">:count</span><span class="p">,</span><span class="w"> </span><span class="ss">:visits</span><span class="p" data-group-id="0341197867-1">)</span><span class="w">

</span><span class="c1"># Returns the number of visits per blog post in the &quot;private&quot; schema path</span><span class="w">
</span><span class="c1"># (in Postgres) or database (in MySQL)</span><span class="w">
</span><span class="nc">Repo</span><span class="o">.</span><span class="n">aggregate</span><span class="p" data-group-id="0341197867-2">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">:count</span><span class="p">,</span><span class="w"> </span><span class="ss">:visits</span><span class="p">,</span><span class="w"> </span><span class="ss">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;private&quot;</span><span class="p" data-group-id="0341197867-2">)</span><span class="w">

</span><span class="c1"># Returns the average number of visits for the top 10</span><span class="w">
</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">limit</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="nc">Repo</span><span class="o">.</span><span class="n">aggregate</span><span class="p" data-group-id="0341197867-3">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="ss">:avg</span><span class="p">,</span><span class="w"> </span><span class="ss">:visits</span><span class="p" data-group-id="0341197867-3">)</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:aggregate/4"><code class="inline">Ecto.Repo.aggregate/4</code></a>.</p>
  </section>
</section>
<section class="detail" id="all/2">
    <span id="all/1"></span>
  <div class="detail-header">
    <a href="#all/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">all(queryable, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Fetches all entries from the data store matching the given query.</p>
<p>May raise <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.QueryError.html"><code class="inline">Ecto.QueryError</code></a> if query validation fails.</p>
<h2 id="all/2-options" class="section-heading">
  <a href="#all/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This will be applied to all <code class="inline">from</code>
and <code class="inline">join</code>s in the query that did not have a prefix previously given
either via the <code class="inline">:prefix</code> option on <code class="inline">join</code>/<code class="inline">from</code> or via <code class="inline">@schema_prefix</code>
in the schema. For more information see the &quot;Query Prefix&quot; section of the
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> documentation.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="all/2-example" class="section-heading">
  <a href="#all/2-example" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Example
</h2>

<pre><code class="nohighlight makeup elixir"><span class="c1"># Fetch all post titles</span><span class="w">
</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w">
     </span><span class="ss">select</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="w">
</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">all</span><span class="p" data-group-id="1081932201-1">(</span><span class="n">query</span><span class="p" data-group-id="1081932201-1">)</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:all/2"><code class="inline">Ecto.Repo.all/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="checkout/2">
    <span id="checkout/1"></span>
  <div class="detail-header">
    <a href="#checkout/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">checkout(fun, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Checks out a connection for the duration of the function.</p>
<p>It returns the result of the function. This is useful when
you need to perform multiple operations against the repository
in a row and you want to avoid checking out the connection
multiple times.</p>
<p><a href="#checkout/2"><code class="inline">checkout/2</code></a> and <a href="#transaction/2"><code class="inline">transaction/2</code></a> can be combined and nested
multiple times. If <a href="#checkout/2"><code class="inline">checkout/2</code></a> is called inside the function
of another <a href="#checkout/2"><code class="inline">checkout/2</code></a> call, the function is simply executed,
without checking out a new connection.</p>
<h2 id="checkout/2-options" class="section-heading">
  <a href="#checkout/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:checkout/2"><code class="inline">Ecto.Repo.checkout/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="child_spec/1">
  <div class="detail-header">
    <a href="#child_spec/1" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">child_spec(opts)</h1>
  </div>
  <section class="docstring">
  </section>
</section>
<section class="detail" id="config/0">
  <div class="detail-header">
    <a href="#config/0" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">config()</h1>
  </div>
  <section class="docstring">
<p>Returns the adapter configuration stored in the <code class="inline">:otp_app</code> environment.</p>
<p>If the <code class="inline">c:init/2</code> callback is implemented in the repository,
it will be invoked with the first argument set to <code class="inline">:runtime</code>.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:config/0"><code class="inline">Ecto.Repo.config/0</code></a>.</p>
  </section>
</section>
<section class="detail" id="delete/2">
    <span id="delete/1"></span>
  <div class="detail-header">
    <a href="#delete/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">delete(struct, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Deletes a struct using its primary key.</p>
<p>If the struct has no primary key, <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.NoPrimaryKeyFieldError.html"><code class="inline">Ecto.NoPrimaryKeyFieldError</code></a>
will be raised. If the struct has been removed from db prior to
call, <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.StaleEntryError.html"><code class="inline">Ecto.StaleEntryError</code></a> will be raised.</p>
<p>It returns <code class="inline">{:ok, struct}</code> if the struct has been successfully
deleted or <code class="inline">{:error, changeset}</code> if there was a validation
or a known constraint error.</p>
<h2 id="delete/2-options" class="section-heading">
  <a href="#delete/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This overrides the prefix set
in the query and any <code class="inline">@schema_prefix</code> set in the schema.
</li>
<li><code class="inline">:stale_error_field</code> - The field where stale errors will be added in
the returning changeset. This option can be used to avoid raising
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.StaleEntryError.html"><code class="inline">Ecto.StaleEntryError</code></a>.
</li>
<li><code class="inline">:stale_error_message</code> - The message to add to the configured
<code class="inline">:stale_error_field</code> when stale errors happen, defaults to &quot;is stale&quot;.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="delete/2-example" class="section-heading">
  <a href="#delete/2-example" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Example
</h2>

<pre><code class="nohighlight makeup elixir"><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="7233197975-1">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p" data-group-id="7233197975-1">)</span><span class="w">
</span><span class="k">case</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">delete</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="k" data-group-id="7233197975-2">do</span><span class="w">
  </span><span class="p" data-group-id="7233197975-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">struct</span><span class="p" data-group-id="7233197975-3">}</span><span class="w">       </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1"># Deleted with success</span><span class="w">
  </span><span class="p" data-group-id="7233197975-4">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">changeset</span><span class="p" data-group-id="7233197975-4">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1"># Something went wrong</span><span class="w">
</span><span class="k" data-group-id="7233197975-2">end</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:delete/2"><code class="inline">Ecto.Repo.delete/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="delete!/2">
    <span id="delete!/1"></span>
  <div class="detail-header">
    <a href="#delete!/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">delete!(struct, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Same as <code class="inline">c:delete/2</code> but returns the struct or raises if the changeset is invalid.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:delete!/2"><code class="inline">Ecto.Repo.delete!/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="delete_all/2">
    <span id="delete_all/1"></span>
  <div class="detail-header">
    <a href="#delete_all/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">delete_all(queryable, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Deletes all entries matching the given query.</p>
<p>It returns a tuple containing the number of entries and any returned
result as second element. The second element is <code class="inline">nil</code> by default
unless a <code class="inline">select</code> is supplied in the delete query. Note, however,
not all databases support returning data from DELETEs.</p>
<h2 id="delete_all/2-options" class="section-heading">
  <a href="#delete_all/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This overrides the prefix set
in the query and any <code class="inline">@schema_prefix</code> set in the schema.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for
remaining options.</p>
<h2 id="delete_all/2-examples" class="section-heading">
  <a href="#delete_all/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="nc">MyRepo</span><span class="o">.</span><span class="n">delete_all</span><span class="p" data-group-id="1811747985-1">(</span><span class="nc">Post</span><span class="p" data-group-id="1811747985-1">)</span><span class="w">

</span><span class="n">from</span><span class="p" data-group-id="1811747985-2">(</span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">where</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="1811747985-2">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">delete_all</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:delete_all/2"><code class="inline">Ecto.Repo.delete_all/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="exists?/2">
    <span id="exists?/1"></span>
  <div class="detail-header">
    <a href="#exists?/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">exists?(queryable, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Checks if there exists an entry that matches the given query.</p>
<p>Returns a boolean.</p>
<h2 id="exists?/2-options" class="section-heading">
  <a href="#exists?/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This will be applied to all <code class="inline">from</code>
and <code class="inline">join</code>s in the query that did not have a prefix previously given
either via the <code class="inline">:prefix</code> option on <code class="inline">join</code>/<code class="inline">from</code> or via <code class="inline">@schema_prefix</code>
in the schema. For more information see the &quot;Query Prefix&quot; section of the
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> documentation.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="exists?/2-examples" class="section-heading">
  <a href="#exists?/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="c1"># checks if any posts exist</span><span class="w">
</span><span class="nc">Repo</span><span class="o">.</span><span class="n">exists?</span><span class="p" data-group-id="2947552855-1">(</span><span class="nc">Post</span><span class="p" data-group-id="2947552855-1">)</span><span class="w">

</span><span class="c1"># checks if any posts exist in the &quot;private&quot; schema path (in Postgres) or</span><span class="w">
</span><span class="c1"># database (in MySQL)</span><span class="w">
</span><span class="nc">Repo</span><span class="o">.</span><span class="n">exists?</span><span class="p" data-group-id="2947552855-2">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">schema</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;private&quot;</span><span class="p" data-group-id="2947552855-2">)</span><span class="w">

</span><span class="c1"># checks if any post with a like count greater than 10 exists</span><span class="w">
</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">where</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">like_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="nc">Repo</span><span class="o">.</span><span class="n">exists?</span><span class="p" data-group-id="2947552855-3">(</span><span class="n">query</span><span class="p" data-group-id="2947552855-3">)</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:exists?/2"><code class="inline">Ecto.Repo.exists?/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="get/3">
    <span id="get/2"></span>
  <div class="detail-header">
    <a href="#get/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">get(queryable, id, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Fetches a single struct from the data store where the primary key matches the
given id.</p>
<p>Returns <code class="inline">nil</code> if no result was found. If the struct in the queryable
has no or more than one primary key, it will raise an argument error.</p>
<h2 id="get/3-options" class="section-heading">
  <a href="#get/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This will be applied to all <code class="inline">from</code>
and <code class="inline">join</code>s in the query that did not have a prefix previously given
either via the <code class="inline">:prefix</code> option on <code class="inline">join</code>/<code class="inline">from</code> or via <code class="inline">@schema_prefix</code>
in the schema. For more information see the &quot;Query Prefix&quot; section of the
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> documentation.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="get/3-example" class="section-heading">
  <a href="#get/3-example" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Example
</h2>

<pre><code class="nohighlight makeup elixir"><span class="nc">MyRepo</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="9298322476-1">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p" data-group-id="9298322476-1">)</span><span class="w">

</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="9298322476-2">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="ss">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p" data-group-id="9298322476-2">)</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:get/3"><code class="inline">Ecto.Repo.get/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="get!/3">
    <span id="get!/2"></span>
  <div class="detail-header">
    <a href="#get!/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">get!(queryable, id, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Similar to <code class="inline">c:get/3</code> but raises <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if no record was found.</p>
<h2 id="get!/3-options" class="section-heading">
  <a href="#get!/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This will be applied to all <code class="inline">from</code>
and <code class="inline">join</code>s in the query that did not have a prefix previously given
either via the <code class="inline">:prefix</code> option on <code class="inline">join</code>/<code class="inline">from</code> or via <code class="inline">@schema_prefix</code>
in the schema. For more information see the &quot;Query Prefix&quot; section of the
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> documentation.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="get!/3-example" class="section-heading">
  <a href="#get!/3-example" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Example
</h2>

<pre><code class="nohighlight makeup elixir"><span class="nc">MyRepo</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="0096518844-1">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p" data-group-id="0096518844-1">)</span><span class="w">

</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="0096518844-2">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="ss">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p" data-group-id="0096518844-2">)</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:get!/3"><code class="inline">Ecto.Repo.get!/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_by/3">
    <span id="get_by/2"></span>
  <div class="detail-header">
    <a href="#get_by/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">get_by(queryable, clauses, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Fetches a single result from the query.</p>
<p>Returns <code class="inline">nil</code> if no result was found. Raises if more than one entry.</p>
<h2 id="get_by/3-options" class="section-heading">
  <a href="#get_by/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This will be applied to all <code class="inline">from</code>
and <code class="inline">join</code>s in the query that did not have a prefix previously given
either via the <code class="inline">:prefix</code> option on <code class="inline">join</code>/<code class="inline">from</code> or via <code class="inline">@schema_prefix</code>
in the schema. For more information see the &quot;Query Prefix&quot; section of the
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> documentation.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="get_by/3-example" class="section-heading">
  <a href="#get_by/3-example" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Example
</h2>

<pre><code class="nohighlight makeup elixir"><span class="nc">MyRepo</span><span class="o">.</span><span class="n">get_by</span><span class="p" data-group-id="2530199391-1">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My post&quot;</span><span class="p" data-group-id="2530199391-1">)</span><span class="w">

</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">get_by</span><span class="p" data-group-id="2530199391-2">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2530199391-3">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My post&quot;</span><span class="p" data-group-id="2530199391-3">]</span><span class="p">,</span><span class="w"> </span><span class="ss">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p" data-group-id="2530199391-2">)</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:get_by/3"><code class="inline">Ecto.Repo.get_by/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_by!/3">
    <span id="get_by!/2"></span>
  <div class="detail-header">
    <a href="#get_by!/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">get_by!(queryable, clauses, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Similar to <code class="inline">c:get_by/3</code> but raises <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if no record was found.</p>
<p>Raises if more than one entry.</p>
<h2 id="get_by!/3-options" class="section-heading">
  <a href="#get_by!/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This will be applied to all <code class="inline">from</code>
and <code class="inline">join</code>s in the query that did not have a prefix previously given
either via the <code class="inline">:prefix</code> option on <code class="inline">join</code>/<code class="inline">from</code> or via <code class="inline">@schema_prefix</code>
in the schema. For more information see the &quot;Query Prefix&quot; section of the
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> documentation.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="get_by!/3-example" class="section-heading">
  <a href="#get_by!/3-example" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Example
</h2>

<pre><code class="nohighlight makeup elixir"><span class="nc">MyRepo</span><span class="o">.</span><span class="n">get_by!</span><span class="p" data-group-id="0898017345-1">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My post&quot;</span><span class="p" data-group-id="0898017345-1">)</span><span class="w">

</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">get_by!</span><span class="p" data-group-id="0898017345-2">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0898017345-3">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My post&quot;</span><span class="p" data-group-id="0898017345-3">]</span><span class="p">,</span><span class="w"> </span><span class="ss">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p" data-group-id="0898017345-2">)</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:get_by!/3"><code class="inline">Ecto.Repo.get_by!/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_dynamic_repo/0">
  <div class="detail-header">
    <a href="#get_dynamic_repo/0" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">get_dynamic_repo()</h1>
  </div>
  <section class="docstring">
<p>Returns the atom name or pid of the current repository.</p>
<p>See <code class="inline">c:put_dynamic_repo/1</code> for more information.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:get_dynamic_repo/0"><code class="inline">Ecto.Repo.get_dynamic_repo/0</code></a>.</p>
  </section>
</section>
<section class="detail" id="in_transaction?/0">
  <div class="detail-header">
    <a href="#in_transaction?/0" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">in_transaction?()</h1>
  </div>
  <section class="docstring">
<p>Returns true if the current process is inside a transaction.</p>
<p>If you are using the <a href="https://hexdocs.pm/ecto_sql/3.2.1/Ecto.Adapters.SQL.Sandbox.html"><code class="inline">Ecto.Adapters.SQL.Sandbox</code></a> in tests, note that even
though each test is inside a transaction, <a href="#in_transaction?/0"><code class="inline">in_transaction?/0</code></a> will only
return true inside transactions explicitly created with <a href="#transaction/2"><code class="inline">transaction/2</code></a>. This
is done so the test environment mimics dev and prod.</p>
<p>If you are trying to debug transaction-related code while using
<a href="https://hexdocs.pm/ecto_sql/3.2.1/Ecto.Adapters.SQL.Sandbox.html"><code class="inline">Ecto.Adapters.SQL.Sandbox</code></a>, it may be more helpful to configure the database
to log all statements and consult those logs.</p>
<h2 id="in_transaction?/0-examples" class="section-heading">
  <a href="#in_transaction?/0-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="nc">MyRepo</span><span class="o">.</span><span class="n">in_transaction?</span><span class="w">
</span><span class="c1">#=&gt; false</span><span class="w">

</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">transaction</span><span class="p" data-group-id="1856696739-1">(</span><span class="k" data-group-id="1856696739-2">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">in_transaction?</span><span class="w"> </span><span class="c1">#=&gt; true</span><span class="w">
</span><span class="k" data-group-id="1856696739-2">end</span><span class="p" data-group-id="1856696739-1">)</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:in_transaction?/0"><code class="inline">Ecto.Repo.in_transaction?/0</code></a>.</p>
  </section>
</section>
<section class="detail" id="insert/2">
    <span id="insert/1"></span>
  <div class="detail-header">
    <a href="#insert/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">insert(struct, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Inserts a struct defined via <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Schema.html"><code class="inline">Ecto.Schema</code></a> or a changeset.</p>
<p>In case a struct is given, the struct is converted into a changeset
with all non-nil fields as part of the changeset.</p>
<p>In case a changeset is given, the changes in the changeset are
merged with the struct fields, and all of them are sent to the
database.</p>
<p>It returns <code class="inline">{:ok, struct}</code> if the struct has been successfully
inserted or <code class="inline">{:error, changeset}</code> if there was a validation
or a known constraint error.</p>
<h2 id="insert/2-options" class="section-heading">
  <a href="#insert/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:returning</code> - selects which fields to return. It accepts a list
of fields to be returned from the database. When <code class="inline">true</code>, returns
all fields. When <code class="inline">false</code>, no extra fields are returned. It will
always include all fields in <code class="inline">read_after_writes</code> as well as any
autogenerated id. Not all databases support this option.
</li>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This overrides the prefix set
in the query and any <code class="inline">@schema_prefix</code> set any schemas. Also, the
<code class="inline">@schema_prefix</code> for the parent record will override all default
<code class="inline">@schema_prefix</code>s set in any child schemas for associations.
</li>
<li><code class="inline">:on_conflict</code> - It may be one of <code class="inline">:raise</code> (the default), <code class="inline">:nothing</code>,
<code class="inline">:replace_all</code>, <code class="inline">:replace_all_except_primary_key</code>, <code class="inline">{:replace, fields}</code>,
a keyword list of update instructions or an <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> query for updates.
See the &quot;Upserts&quot; section for more information.
</li>
<li><code class="inline">:conflict_target</code> - A list of column names to verify for conflicts.
It is expected those columns to have unique indexes on them that may conflict.
If none is specified, the conflict target is left up to the database.
May also be <code class="inline">{:constraint, constraint_name_as_atom}</code> in databases
that support the &quot;ON CONSTRAINT&quot; expression, such as PostgreSQL.
</li>
<li><code class="inline">:stale_error_field</code> - The field where stale errors will be added in
the returning changeset. This option can be used to avoid raising
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.StaleEntryError.html"><code class="inline">Ecto.StaleEntryError</code></a>.
</li>
<li><code class="inline">:stale_error_message</code> - The message to add to the configured
<code class="inline">:stale_error_field</code> when stale errors happen, defaults to &quot;is stale&quot;.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="insert/2-examples" class="section-heading">
  <a href="#insert/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<p>A typical example is calling <code class="inline">MyRepo.insert/1</code> with a struct
and acting on the return value:</p>
<pre><code class="nohighlight makeup elixir"><span class="k">case</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert</span><span class="w"> </span><span class="p" data-group-id="6285889598-1">%</span><span class="nc" data-group-id="6285889598-1">Post</span><span class="p" data-group-id="6285889598-1">{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ecto is great&quot;</span><span class="p" data-group-id="6285889598-1">}</span><span class="w"> </span><span class="k" data-group-id="6285889598-2">do</span><span class="w">
  </span><span class="p" data-group-id="6285889598-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">struct</span><span class="p" data-group-id="6285889598-3">}</span><span class="w">       </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1"># Inserted with success</span><span class="w">
  </span><span class="p" data-group-id="6285889598-4">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">changeset</span><span class="p" data-group-id="6285889598-4">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1"># Something went wrong</span><span class="w">
</span><span class="k" data-group-id="6285889598-2">end</span></code></pre>
<h2 id="insert/2-upserts" class="section-heading">
  <a href="#insert/2-upserts" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Upserts
</h2>

<p><code class="inline">c:insert/2</code> provides upserts (update or inserts) via the <code class="inline">:on_conflict</code>
option. The <code class="inline">:on_conflict</code> option supports the following values:</p>
<ul>
<li><code class="inline">:raise</code> - raises if there is a conflicting primary key or unique index
</li>
<li><code class="inline">:nothing</code> - ignores the error in case of conflicts
</li>
<li><code class="inline">:replace_all</code> - replace all values on the existing row with the values
in the schema/changeset, including autogenerated fields such as <code class="inline">inserted_at</code>
and <code class="inline">updated_at</code>
</li>
<li><code class="inline">:replace_all_except_primary_key</code> - same as above except primary keys are
not replaced
</li>
<li><code class="inline">{:replace, fields}</code> - replace only specific columns. This option requires
conflict_target
</li>
<li>a keyword list of update instructions - such as the one given to
<code class="inline">c:update_all/3</code>, for example: <code class="inline">[set: [title: &quot;new title&quot;]]</code>
</li>
<li>an <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> that will act as an <code class="inline">UPDATE</code> statement, such as the
one given to <code class="inline">c:update_all/3</code>. If the struct cannot be found, <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.StaleEntryError.html"><code class="inline">Ecto.StaleEntryError</code></a>
will be raised.
</li>
</ul>
<p>Upserts map to &quot;ON CONFLICT&quot; on databases like Postgres and &quot;ON DUPLICATE KEY&quot;
on databases such as MySQL.</p>
<p>As an example, imagine <code class="inline">:title</code> is marked as a unique column in
the database:</p>
<pre><code class="nohighlight makeup elixir"><span class="p" data-group-id="8175208766-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">inserted</span><span class="p" data-group-id="8175208766-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="8175208766-2">(</span><span class="p" data-group-id="8175208766-3">%</span><span class="nc" data-group-id="8175208766-3">Post</span><span class="p" data-group-id="8175208766-3">{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;this is unique&quot;</span><span class="p" data-group-id="8175208766-3">}</span><span class="p" data-group-id="8175208766-2">)</span></code></pre>
<p>Now we can insert with the same title but do nothing on conflicts:</p>
<pre><code class="nohighlight makeup elixir"><span class="p" data-group-id="6850859897-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">ignored</span><span class="p" data-group-id="6850859897-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="6850859897-2">(</span><span class="p" data-group-id="6850859897-3">%</span><span class="nc" data-group-id="6850859897-3">Post</span><span class="p" data-group-id="6850859897-3">{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;this is unique&quot;</span><span class="p" data-group-id="6850859897-3">}</span><span class="p">,</span><span class="w"> </span><span class="ss">on_conflict</span><span class="p">:</span><span class="w"> </span><span class="ss">:nothing</span><span class="p" data-group-id="6850859897-2">)</span><span class="w">
</span><span class="n">assert</span><span class="w"> </span><span class="n">ignored</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">nil</span></code></pre>
<p>Because we used <code class="inline">on_conflict: :nothing</code>, instead of getting an error,
we got <code class="inline">{:ok, struct}</code>. However the returned struct does not reflect
the data in the database. One possible mechanism to detect if an
insert or nothing happened in case of <code class="inline">on_conflict: :nothing</code> is by
checking the <code class="inline">id</code> field. <code class="inline">id</code> will be nil if the field is autogenerated
by the database and no insert happened.</p>
<p>For actual upserts, where an insert or update may happen, the situation
is slightly more complex, as the database does not actually inform us
if an insert or update happened. Let&#39;s insert a post with the same title
but use a query to update the body column in case of conflicts:</p>
<pre><code class="nohighlight makeup elixir"><span class="c1"># In Postgres (it requires the conflict target for updates):</span><span class="w">
</span><span class="n">on_conflict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5677359661-1">[</span><span class="ss">set</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5677359661-2">[</span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;updated&quot;</span><span class="p" data-group-id="5677359661-2">]</span><span class="p" data-group-id="5677359661-1">]</span><span class="w">
</span><span class="p" data-group-id="5677359661-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">updated</span><span class="p" data-group-id="5677359661-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="5677359661-4">(</span><span class="p" data-group-id="5677359661-5">%</span><span class="nc" data-group-id="5677359661-5">Post</span><span class="p" data-group-id="5677359661-5">{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;this is unique&quot;</span><span class="p" data-group-id="5677359661-5">}</span><span class="p">,</span><span class="w">
                               </span><span class="ss">on_conflict</span><span class="p">:</span><span class="w"> </span><span class="n">on_conflict</span><span class="p">,</span><span class="w"> </span><span class="ss">conflict_target</span><span class="p">:</span><span class="w"> </span><span class="ss">:title</span><span class="p" data-group-id="5677359661-4">)</span><span class="w">

</span><span class="c1"># In MySQL (conflict target is not supported):</span><span class="w">
</span><span class="n">on_conflict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5677359661-6">[</span><span class="ss">set</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5677359661-7">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;updated&quot;</span><span class="p" data-group-id="5677359661-7">]</span><span class="p" data-group-id="5677359661-6">]</span><span class="w">
</span><span class="p" data-group-id="5677359661-8">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">updated</span><span class="p" data-group-id="5677359661-8">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="5677359661-9">(</span><span class="p" data-group-id="5677359661-10">%</span><span class="nc" data-group-id="5677359661-10">Post</span><span class="p" data-group-id="5677359661-10">{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="n">inserted</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;updated&quot;</span><span class="p" data-group-id="5677359661-10">}</span><span class="p">,</span><span class="w">
                               </span><span class="ss">on_conflict</span><span class="p">:</span><span class="w"> </span><span class="n">on_conflict</span><span class="p" data-group-id="5677359661-9">)</span></code></pre>
<p>In the examples above, even though it returned <code class="inline">:ok</code>, we do not know
if we inserted new data or if we updated only the <code class="inline">:on_conflict</code> fields.
In case an update happened, the data in the struct most likely does
not match the data in the database. For example, autogenerated fields
such as <code class="inline">inserted_at</code> will point to now rather than the time the
struct was actually inserted.</p>
<p>If you need to guarantee the data in the returned struct mirrors the
database, you have three options:</p>
<ul>
<li><p>Use <code class="inline">on_conflict: :replace_all</code>, although that will replace all
fields in the database with the ones in the struct/changeset,
including autogenerated fields such as <code class="inline">insert_at</code> and <code class="inline">updated_at</code>:</p>
<pre><code class="nohighlight makeup elixir"><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="0359508411-1">(</span><span class="p" data-group-id="0359508411-2">%</span><span class="nc" data-group-id="0359508411-2">Post</span><span class="p" data-group-id="0359508411-2">{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;this is unique&quot;</span><span class="p" data-group-id="0359508411-2">}</span><span class="p">,</span><span class="w">
              </span><span class="ss">on_conflict</span><span class="p">:</span><span class="w"> </span><span class="ss">:replace_all</span><span class="p">,</span><span class="w"> </span><span class="ss">conflict_target</span><span class="p">:</span><span class="w"> </span><span class="ss">:title</span><span class="p" data-group-id="0359508411-1">)</span></code></pre>
</li>
<li><p>Specify <code class="inline">read_after_writes: true</code> in your schema for choosing
fields that are read from the database after every operation.
Or pass <code class="inline">returning: true</code> to <code class="inline">insert</code> to read all fields back:</p>
<pre><code class="nohighlight makeup elixir"><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="2630862082-1">(</span><span class="p" data-group-id="2630862082-2">%</span><span class="nc" data-group-id="2630862082-2">Post</span><span class="p" data-group-id="2630862082-2">{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;this is unique&quot;</span><span class="p" data-group-id="2630862082-2">}</span><span class="p">,</span><span class="w"> </span><span class="ss">returning</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w">
              </span><span class="ss">on_conflict</span><span class="p">:</span><span class="w"> </span><span class="n">on_conflict</span><span class="p">,</span><span class="w"> </span><span class="ss">conflict_target</span><span class="p">:</span><span class="w"> </span><span class="ss">:title</span><span class="p" data-group-id="2630862082-1">)</span></code></pre>
</li>
<li><p>Alternatively, read the data again from the database in a separate
query. This option requires the primary key to be generated by the
database:</p>
<pre><code class="nohighlight makeup elixir"><span class="p" data-group-id="7078300764-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">updated</span><span class="p" data-group-id="7078300764-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="7078300764-2">(</span><span class="p" data-group-id="7078300764-3">%</span><span class="nc" data-group-id="7078300764-3">Post</span><span class="p" data-group-id="7078300764-3">{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;this is unique&quot;</span><span class="p" data-group-id="7078300764-3">}</span><span class="p">,</span><span class="w"> </span><span class="ss">on_conflict</span><span class="p">:</span><span class="w"> </span><span class="n">on_conflict</span><span class="p" data-group-id="7078300764-2">)</span><span class="w">
</span><span class="nc">Repo</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="7078300764-4">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="n">updated</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="7078300764-4">)</span></code></pre>
</li>
</ul>
<p>Because of the inability to know if the struct is up to date or not,
inserting a struct with associations and using the <code class="inline">:on_conflict</code> option
at the same time is not recommended, as Ecto will be unable to actually
track the proper status of the association.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:insert/2"><code class="inline">Ecto.Repo.insert/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="insert!/2">
    <span id="insert!/1"></span>
  <div class="detail-header">
    <a href="#insert!/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">insert!(struct, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Same as <code class="inline">c:insert/2</code> but returns the struct or raises if the changeset is invalid.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:insert!/2"><code class="inline">Ecto.Repo.insert!/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="insert_all/3">
    <span id="insert_all/2"></span>
  <div class="detail-header">
    <a href="#insert_all/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">insert_all(schema_or_source, entries, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Inserts all entries into the repository.</p>
<p>It expects a schema module (<code class="inline">MyApp.User</code>) or a source (<code class="inline">&quot;users&quot;</code>) or
both (<code class="inline">{&quot;users&quot;, MyApp.User}</code>) as the first argument. The second
argument is a list of entries to be inserted, either as keyword
lists or as maps. The keys of the entries are the field names as
atoms and the value should be the respective value for the field
type or, optionally, an <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> that returns a single entry
with a single value.</p>
<p>It returns a tuple containing the number of entries
and any returned result as second element. If the database
does not support RETURNING in INSERT statements or no
return result was selected, the second element will be <code class="inline">nil</code>.</p>
<p>When a schema module is given, the entries given will be properly dumped
before being sent to the database. If the schema contains an
autogenerated ID field, it will be handled either at the adapter
or the storage layer. However any other autogenerated value, like
timestamps, won&#39;t be autogenerated when using <code class="inline">c:insert_all/3</code>.
This is by design as this function aims to be a more direct way
to insert data into the database without the conveniences of
<code class="inline">c:insert/2</code>. This is also consistent with <code class="inline">c:update_all/3</code> that
does not handle timestamps as well.</p>
<p>It is also not possible to use <code class="inline">insert_all</code> to insert across multiple
tables, therefore associations are not supported.</p>
<p>If a source is given, without a schema module, the given fields are passed
as is to the adapter.</p>
<h2 id="insert_all/3-options" class="section-heading">
  <a href="#insert_all/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:returning</code> - selects which fields to return. When <code class="inline">true</code>,
returns all fields in the given schema. May be a list of
fields, where a struct is still returned but only with the
given fields. Or <code class="inline">false</code>, where nothing is returned (the default).
This option is not supported by all databases.
</li>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This overrides the prefix set
in the query and any <code class="inline">@schema_prefix</code> set in the schema.
</li>
<li><code class="inline">:on_conflict</code> - It may be one of <code class="inline">:raise</code> (the default), <code class="inline">:nothing</code>,
<code class="inline">:replace_all</code>, <code class="inline">:replace_all_except_primary_key</code>, <code class="inline">{:replace, fields}</code>,
a keyword list of update instructions or an <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a>
query for updates. See the &quot;Upserts&quot; section for more information.
</li>
<li><code class="inline">:conflict_target</code> - A list of column names to verify for conflicts.
It is expected those columns to have unique indexes on them that may conflict.
If none is specified, the conflict target is left up to the database.
It may also be <code class="inline">{:constraint, constraint_name_as_atom}</code> in databases
that support the &quot;ON CONSTRAINT&quot; expression, such as PostgreSQL, or
<code class="inline">{:unsafe_fragment, binary_fragment}</code> to pass any expression to the
database without any sanitization, such as
<code class="inline">ON CONFLICT (coalesce(firstname, &quot;&quot;), coalesce(lastname, &quot;&quot;))</code>.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for
remaining options.</p>
<h2 id="insert_all/3-examples" class="section-heading">
  <a href="#insert_all/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert_all</span><span class="p" data-group-id="5317939878-1">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5317939878-2">[</span><span class="p" data-group-id="5317939878-3">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My first post&quot;</span><span class="p" data-group-id="5317939878-3">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5317939878-4">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My second post&quot;</span><span class="p" data-group-id="5317939878-4">]</span><span class="p" data-group-id="5317939878-2">]</span><span class="p" data-group-id="5317939878-1">)</span><span class="w">

</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert_all</span><span class="p" data-group-id="5317939878-5">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5317939878-6">[</span><span class="p" data-group-id="5317939878-7">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My first post&quot;</span><span class="p" data-group-id="5317939878-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5317939878-8">%{</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My second post&quot;</span><span class="p" data-group-id="5317939878-8">}</span><span class="p" data-group-id="5317939878-6">]</span><span class="p" data-group-id="5317939878-5">)</span></code></pre>
<h2 id="insert_all/3-upserts" class="section-heading">
  <a href="#insert_all/3-upserts" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Upserts
</h2>

<p><code class="inline">c:insert_all/3</code> provides upserts (update or inserts) via the <code class="inline">:on_conflict</code>
option. The <code class="inline">:on_conflict</code> option supports the following values:</p>
<ul>
<li><code class="inline">:raise</code> - raises if there is a conflicting primary key or unique index
</li>
<li><code class="inline">:nothing</code> - ignores the error in case of conflicts
</li>
<li><code class="inline">:replace_all</code> - replace all values on the existing row by the new entry,
including values not sent explicitly by Ecto, such as database defaults.
This option requires a schema
</li>
<li><code class="inline">:replace_all_except_primary_key</code> - same as above except primary keys are
not replaced. This option requires a schema
</li>
<li><code class="inline">{:replace, fields}</code> - replace only specific columns. This option requires
conflict_target
</li>
<li>a keyword list of update instructions - such as the one given to
<code class="inline">c:update_all/3</code>, for example: <code class="inline">[set: [title: &quot;new title&quot;]]</code>
</li>
<li>an <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> that will act as an <code class="inline">UPDATE</code> statement, such as the
one given to <code class="inline">c:update_all/3</code>
</li>
</ul>
<p>Upserts map to &quot;ON CONFLICT&quot; on databases like Postgres and &quot;ON DUPLICATE KEY&quot;
on databases such as MySQL.</p>
<h2 id="insert_all/3-return-values" class="section-heading">
  <a href="#insert_all/3-return-values" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Return values
</h2>

<p>By default, both Postgres and MySQL return the amount of entries
inserted on <code class="inline">c:insert_all/3</code>. However, when the <code class="inline">:on_conflict</code> option
is specified, Postgres will only return a row if it was affected
while MySQL returns at least the number of entries attempted.</p>
<p>For example, if <code class="inline">:on_conflict</code> is set to <code class="inline">:nothing</code>, Postgres will
return 0 if no new entry was added while MySQL will still return
the amount of entries attempted to be inserted, even if no entry
was added. Even worse, if <code class="inline">:on_conflict</code> is query, MySQL will return
the number of attempted entries plus the number of entries modified
by the UPDATE query.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:insert_all/3"><code class="inline">Ecto.Repo.insert_all/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="insert_or_update/2">
    <span id="insert_or_update/1"></span>
  <div class="detail-header">
    <a href="#insert_or_update/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">insert_or_update(changeset, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Inserts or updates a changeset depending on whether the struct is persisted
or not.</p>
<p>The distinction whether to insert or update will be made on the
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Schema.Metadata.html"><code class="inline">Ecto.Schema.Metadata</code></a> field <code class="inline">:state</code>. The <code class="inline">:state</code> is automatically set by
Ecto when loading or building a schema.</p>
<p>Please note that for this to work, you will have to load existing structs from
the database. So even if the struct exists, this won&#39;t work:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">struct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4569889766-1">%</span><span class="nc" data-group-id="4569889766-1">Post</span><span class="p" data-group-id="4569889766-1">{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;existing_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="4569889766-1">}</span><span class="w">
</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert_or_update</span><span class="w"> </span><span class="n">changeset</span><span class="w">
</span><span class="c1"># =&gt; {:error, changeset} # id already exists</span></code></pre>
<h2 id="insert_or_update/2-options" class="section-heading">
  <a href="#insert_or_update/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This overrides the prefix set
in the query and any <code class="inline">@schema_prefix</code> set any schemas. Also, the
<code class="inline">@schema_prefix</code> for the parent record will override all default
<code class="inline">@schema_prefix</code>s set in any child schemas for associations.
</li>
<li><code class="inline">:stale_error_field</code> - The field where stale errors will be added in
the returning changeset. This option can be used to avoid raising
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.StaleEntryError.html"><code class="inline">Ecto.StaleEntryError</code></a>. Only applies to updates.
</li>
<li><code class="inline">:stale_error_message</code> - The message to add to the configured
<code class="inline">:stale_error_field</code> when stale errors happen, defaults to &quot;is stale&quot;.
Only applies to updates.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="insert_or_update/2-example" class="section-heading">
  <a href="#insert_or_update/2-example" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Example
</h2>

<pre><code class="nohighlight makeup elixir"><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="k">case</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="2551858836-1">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p" data-group-id="2551858836-1">)</span><span class="w"> </span><span class="k" data-group-id="2551858836-2">do</span><span class="w">
    </span><span class="no">nil</span><span class="w">  </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="2551858836-3">%</span><span class="nc" data-group-id="2551858836-3">Post</span><span class="p" data-group-id="2551858836-3">{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="n">id</span><span class="p" data-group-id="2551858836-3">}</span><span class="w"> </span><span class="c1"># Post not found, we build one</span><span class="w">
    </span><span class="n">post</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">post</span><span class="w">          </span><span class="c1"># Post exists, let&#39;s use it</span><span class="w">
  </span><span class="k" data-group-id="2551858836-2">end</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Post</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="2551858836-4">(</span><span class="n">changes</span><span class="p" data-group-id="2551858836-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert_or_update</span><span class="w">

</span><span class="k">case</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="k" data-group-id="2551858836-5">do</span><span class="w">
  </span><span class="p" data-group-id="2551858836-6">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">struct</span><span class="p" data-group-id="2551858836-6">}</span><span class="w">       </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1"># Inserted or updated with success</span><span class="w">
  </span><span class="p" data-group-id="2551858836-7">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">changeset</span><span class="p" data-group-id="2551858836-7">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1"># Something went wrong</span><span class="w">
</span><span class="k" data-group-id="2551858836-5">end</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:insert_or_update/2"><code class="inline">Ecto.Repo.insert_or_update/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="insert_or_update!/2">
    <span id="insert_or_update!/1"></span>
  <div class="detail-header">
    <a href="#insert_or_update!/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">insert_or_update!(changeset, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Same as <code class="inline">c:insert_or_update/2</code> but returns the struct or raises if the changeset
is invalid.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:insert_or_update!/2"><code class="inline">Ecto.Repo.insert_or_update!/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="load/2">
  <div class="detail-header">
    <a href="#load/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">load(schema_or_types, data)</h1>
  </div>
  <section class="docstring">
<p>Loads <code class="inline">data</code> into a struct or a map.</p>
<p>The first argument can be a a schema module, or a
map (of types) and determines the return value:
a struct or a map, respectively.</p>
<p>The second argument <code class="inline">data</code> specifies fields and values that are to be loaded.
It can be a map, a keyword list, or a <code class="inline">{fields, values}</code> tuple.
Fields can be atoms or strings.</p>
<p>Fields that are not present in the schema (or <code class="inline">types</code> map) are ignored.
If any of the values has invalid type, an error is raised.</p>
<h2 id="load/2-examples" class="section-heading">
  <a href="#load/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">load</span><span class="p" data-group-id="5974833659-1">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5974833659-2">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p" data-group-id="5974833659-2">}</span><span class="p" data-group-id="5974833659-1">)</span><span class="w">
</span><span class="p" data-group-id="5974833659-3">%</span><span class="nc" data-group-id="5974833659-3">User</span><span class="p" data-group-id="5974833659-3">{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p" data-group-id="5974833659-3">}</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">load</span><span class="p" data-group-id="5974833659-4">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5974833659-5">[</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p" data-group-id="5974833659-5">]</span><span class="p" data-group-id="5974833659-4">)</span><span class="w">
</span><span class="p" data-group-id="5974833659-6">%</span><span class="nc" data-group-id="5974833659-6">User</span><span class="p" data-group-id="5974833659-6">{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p" data-group-id="5974833659-6">}</span></code></pre>
<p><code class="inline">data</code> can also take form of <code class="inline">{fields, values}</code>:</p>
<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">load</span><span class="p" data-group-id="1929778034-1">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1929778034-2">{</span><span class="p" data-group-id="1929778034-3">[</span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="ss">:age</span><span class="p" data-group-id="1929778034-3">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1929778034-4">[</span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p" data-group-id="1929778034-4">]</span><span class="p" data-group-id="1929778034-2">}</span><span class="p" data-group-id="1929778034-1">)</span><span class="w">
</span><span class="p" data-group-id="1929778034-5">%</span><span class="nc" data-group-id="1929778034-5">User</span><span class="p" data-group-id="1929778034-5">{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="1929778034-5">}</span></code></pre>
<p>The first argument can also be a <code class="inline">types</code> map:</p>
<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="n">types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4271275013-1">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="ss">:string</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="ss">:integer</span><span class="p" data-group-id="4271275013-1">}</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">load</span><span class="p" data-group-id="4271275013-2">(</span><span class="n">types</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4271275013-3">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p" data-group-id="4271275013-3">}</span><span class="p" data-group-id="4271275013-2">)</span><span class="w">
</span><span class="p" data-group-id="4271275013-4">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p" data-group-id="4271275013-4">}</span></code></pre>
<p>This function is especially useful when parsing raw query results:</p>
<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Ecto.Adapters.SQL</span><span class="o">.</span><span class="n">query!</span><span class="p" data-group-id="6744888797-1">(</span><span class="nc">MyRepo</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SELECT * FROM users&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6744888797-2">[</span><span class="p" data-group-id="6744888797-2">]</span><span class="p" data-group-id="6744888797-1">)</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="6744888797-3">(</span><span class="n">result</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">load</span><span class="p" data-group-id="6744888797-4">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6744888797-5">{</span><span class="n">result</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="w"> </span><span class="ni">&amp;1</span><span class="p" data-group-id="6744888797-5">}</span><span class="p" data-group-id="6744888797-4">)</span><span class="p" data-group-id="6744888797-3">)</span><span class="w">
</span><span class="p" data-group-id="6744888797-6">[</span><span class="p" data-group-id="6744888797-7">%</span><span class="nc" data-group-id="6744888797-7">User</span><span class="p" data-group-id="6744888797-7">{</span><span class="n">...</span><span class="p" data-group-id="6744888797-7">}</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="6744888797-6">]</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:load/2"><code class="inline">Ecto.Repo.load/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="one/2">
    <span id="one/1"></span>
  <div class="detail-header">
    <a href="#one/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">one(queryable, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Fetches a single result from the query.</p>
<p>Returns <code class="inline">nil</code> if no result was found. Raises if more than one entry.</p>
<h2 id="one/2-options" class="section-heading">
  <a href="#one/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This will be applied to all <code class="inline">from</code>
and <code class="inline">join</code>s in the query that did not have a prefix previously given
either via the <code class="inline">:prefix</code> option on <code class="inline">join</code>/<code class="inline">from</code> or via <code class="inline">@schema_prefix</code>
in the schema. For more information see the &quot;Query Prefix&quot; section of the
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> documentation.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="one/2-examples" class="section-heading">
  <a href="#one/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="nc">Repo</span><span class="o">.</span><span class="n">one</span><span class="p" data-group-id="5136392613-1">(</span><span class="nc">Post</span><span class="p" data-group-id="5136392613-1">)</span><span class="w">

</span><span class="nc">Repo</span><span class="o">.</span><span class="n">one</span><span class="p" data-group-id="5136392613-2">(</span><span class="n">from</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">where</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">like_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="5136392613-2">)</span><span class="w">

</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">where</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">like_count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="nc">Repo</span><span class="o">.</span><span class="n">one</span><span class="p" data-group-id="5136392613-3">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="ss">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;private&quot;</span><span class="p" data-group-id="5136392613-3">)</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:one/2"><code class="inline">Ecto.Repo.one/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="one!/2">
    <span id="one!/1"></span>
  <div class="detail-header">
    <a href="#one!/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">one!(queryable, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Similar to <code class="inline">c:one/2</code> but raises <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.NoResultsError.html"><code class="inline">Ecto.NoResultsError</code></a> if no record was found.</p>
<p>Raises if more than one entry.</p>
<h2 id="one!/2-options" class="section-heading">
  <a href="#one!/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This will be applied to all <code class="inline">from</code>
and <code class="inline">join</code>s in the query that did not have a prefix previously given
either via the <code class="inline">:prefix</code> option on <code class="inline">join</code>/<code class="inline">from</code> or via <code class="inline">@schema_prefix</code>
in the schema. For more information see the &quot;Query Prefix&quot; section of the
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> documentation.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:one!/2"><code class="inline">Ecto.Repo.one!/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="preload/3">
    <span id="preload/2"></span>
  <div class="detail-header">
    <a href="#preload/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">preload(struct_or_structs_or_nil, preloads, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Preloads all associations on the given struct or structs.</p>
<p>This is similar to <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html#preload/3"><code class="inline">Ecto.Query.preload/3</code></a> except it allows
you to preload structs after they have been fetched from the
database.</p>
<p>In case the association was already loaded, preload won&#39;t attempt
to reload it.</p>
<h2 id="preload/3-options" class="section-heading">
  <a href="#preload/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:force</code> - By default, Ecto won&#39;t preload associations that
are already loaded. By setting this option to true, any existing
association will be discarded and reloaded.
</li>
<li><code class="inline">:in_parallel</code> - If the preloads must be done in parallel. It can
only be performed when we have more than one preload and the
repository is not in a transaction. Defaults to <code class="inline">true</code>.
</li>
<li><code class="inline">:prefix</code> - the prefix to fetch preloads from. By default, queries
will use the same prefix as the one in the given collection. This
option allows the prefix to be changed.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="preload/3-examples" class="section-heading">
  <a href="#preload/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="c1"># Use a single atom to preload an association</span><span class="w">
</span><span class="n">posts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">preload</span><span class="w"> </span><span class="n">posts</span><span class="p">,</span><span class="w"> </span><span class="ss">:comments</span><span class="w">

</span><span class="c1"># Use a list of atoms to preload multiple associations</span><span class="w">
</span><span class="n">posts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">preload</span><span class="w"> </span><span class="n">posts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6555475840-1">[</span><span class="ss">:comments</span><span class="p">,</span><span class="w"> </span><span class="ss">:authors</span><span class="p" data-group-id="6555475840-1">]</span><span class="w">

</span><span class="c1"># Use a keyword list to preload nested associations as well</span><span class="w">
</span><span class="n">posts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">preload</span><span class="w"> </span><span class="n">posts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6555475840-2">[</span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6555475840-3">[</span><span class="ss">:replies</span><span class="p">,</span><span class="w"> </span><span class="ss">:likes</span><span class="p" data-group-id="6555475840-3">]</span><span class="p">,</span><span class="w"> </span><span class="ss">authors</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6555475840-4">[</span><span class="p" data-group-id="6555475840-4">]</span><span class="p" data-group-id="6555475840-2">]</span><span class="w">

</span><span class="c1"># Use a keyword list to customize how associations are queried</span><span class="w">
</span><span class="n">posts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">preload</span><span class="w"> </span><span class="n">posts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6555475840-5">[</span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="n">from</span><span class="p" data-group-id="6555475840-6">(</span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Comment</span><span class="p">,</span><span class="w"> </span><span class="ss">order_by</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">published_at</span><span class="p" data-group-id="6555475840-6">)</span><span class="p" data-group-id="6555475840-5">]</span><span class="w">

</span><span class="c1"># Use a two-element tuple for a custom query and nested association definition</span><span class="w">
</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Comment</span><span class="p">,</span><span class="w"> </span><span class="ss">order_by</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">published_at</span><span class="w">
</span><span class="n">posts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">preload</span><span class="w"> </span><span class="n">posts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6555475840-7">[</span><span class="ss">comments</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6555475840-8">{</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6555475840-9">[</span><span class="ss">:replies</span><span class="p">,</span><span class="w"> </span><span class="ss">:likes</span><span class="p" data-group-id="6555475840-9">]</span><span class="p" data-group-id="6555475840-8">}</span><span class="p" data-group-id="6555475840-7">]</span></code></pre>
<p>The query given to preload may also preload its own associations.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:preload/3"><code class="inline">Ecto.Repo.preload/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="prepare_query/3">
  <div class="detail-header">
    <a href="#prepare_query/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">prepare_query(operation, query, opts)</h1>
  </div>
  <section class="docstring">
<p>A user customizable callback invoked for query-based operations.</p>
<p>This callback can be used to further modify the query and options
before it is transformed and sent to the database.</p>
<p>This callback is invoked for all query APIs, including the <code class="inline">stream</code>
function, but it is not invoked for <code class="inline">insert_all</code> nor any of the
schema functions.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:prepare_query/3"><code class="inline">Ecto.Repo.prepare_query/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="put_dynamic_repo/1">
  <div class="detail-header">
    <a href="#put_dynamic_repo/1" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">put_dynamic_repo(dynamic)</h1>
  </div>
  <section class="docstring">
<p>Sets the dynamic repository to be used in further interactions.</p>
<p>Sometimes you may want a single Ecto repository to talk to
many different database instances. By default, when you call
<code class="inline">MyApp.Repo.start_link/1</code>, it will start a repository with
name <code class="inline">MyApp.Repo</code>. But if you want to start multiple repositories,
you can give each of them a different name:</p>
<pre><code class="nohighlight makeup elixir"><span class="nc">MyApp.Repo</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="2045452176-1">(</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="ss">:tenant_foo</span><span class="p">,</span><span class="w"> </span><span class="ss">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;foo.example.com&quot;</span><span class="p" data-group-id="2045452176-1">)</span><span class="w">
</span><span class="nc">MyApp.Repo</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="2045452176-2">(</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="ss">:tenant_bar</span><span class="p">,</span><span class="w"> </span><span class="ss">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bar.example.com&quot;</span><span class="p" data-group-id="2045452176-2">)</span></code></pre>
<p>You can also start repositories without names by explicitly
setting the name to nil:</p>
<pre><code class="nohighlight makeup elixir"><span class="nc">MyApp.Repo</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="3616237652-1">(</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p">,</span><span class="w"> </span><span class="ss">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;temp.example.com&quot;</span><span class="p" data-group-id="3616237652-1">)</span></code></pre>
<p>However, once the repository is started, you can&#39;t directly interact with
it, since all operations in <code class="inline">MyApp.Repo</code> are sent by default to the repository
named <code class="inline">MyApp.Repo</code>. You can change the default repo at compile time with:</p>
<pre><code class="nohighlight makeup elixir"><span class="kn">use</span><span class="w"> </span><span class="nc">Ecto.Repo</span><span class="p">,</span><span class="w"> </span><span class="ss">default_dynamic_repo</span><span class="p">:</span><span class="w"> </span><span class="ss">:name_of_repo</span></code></pre>
<p>Or you can change it anytime at runtime by calling <a href="#put_dynamic_repo/1"><code class="inline">put_dynamic_repo/1</code></a>:</p>
<pre><code class="nohighlight makeup elixir"><span class="nc">MyApp.Repo</span><span class="o">.</span><span class="n">put_dynamic_repo</span><span class="p" data-group-id="7053394664-1">(</span><span class="ss">:tenant_foo</span><span class="p" data-group-id="7053394664-1">)</span></code></pre>
<p>From this moment on, all future queries done by the current process will
run on <code class="inline">:tenant_foo</code>.</p>
<p><strong>Note this feature is experimental and may be changed or removed in future
releases.</strong></p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:put_dynamic_repo/1"><code class="inline">Ecto.Repo.put_dynamic_repo/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="query/3">
    <span id="query/1"></span>
    <span id="query/2"></span>
  <div class="detail-header">
    <a href="#query/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">query(sql, params \\ [], opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>A convenience function for SQL-based repositories that executes the given query.</p>
<p>See <a href="https://hexdocs.pm/ecto_sql/3.2.1/Ecto.Adapters.SQL.html#query/4"><code class="inline">Ecto.Adapters.SQL.query/4</code></a> for more information.</p>
  </section>
</section>
<section class="detail" id="query!/3">
    <span id="query!/1"></span>
    <span id="query!/2"></span>
  <div class="detail-header">
    <a href="#query!/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">query!(sql, params \\ [], opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>A convenience function for SQL-based repositories that executes the given query.</p>
<p>See <a href="https://hexdocs.pm/ecto_sql/3.2.1/Ecto.Adapters.SQL.html#query!/4"><code class="inline">Ecto.Adapters.SQL.query!/4</code></a> for more information.</p>
  </section>
</section>
<section class="detail" id="rollback/1">
  <div class="detail-header">
    <a href="#rollback/1" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">rollback(value)</h1>
      <div class="specs">
          <pre>rollback(<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">no_return</a>()</pre>
      </div>
  </div>
  <section class="docstring">
<p>Rolls back the current transaction.</p>
<p>The transaction will return the value given as <code class="inline">{:error, value}</code>.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:rollback/1"><code class="inline">Ecto.Repo.rollback/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="start_link/1">
    <span id="start_link/0"></span>
  <div class="detail-header">
    <a href="#start_link/1" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">start_link(opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Starts any connection pooling or supervision and return <code class="inline">{:ok, pid}</code>
or just <code class="inline">:ok</code> if nothing needs to be done.</p>
<p>Returns <code class="inline">{:error, {:already_started, pid}}</code> if the repo is already
started or <code class="inline">{:error, term}</code> in case anything else goes wrong.</p>
<h2 id="start_link/1-options" class="section-heading">
  <a href="#start_link/1-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<p>See the configuration in the moduledoc for options shared between adapters,
for adapter-specific configuration see the adapter&#39;s documentation.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:start_link/1"><code class="inline">Ecto.Repo.start_link/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="stop/1">
    <span id="stop/0"></span>
  <div class="detail-header">
    <a href="#stop/1" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">stop(timeout \\ 5000)</h1>
  </div>
  <section class="docstring">
<p>Shuts down the repository.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:stop/1"><code class="inline">Ecto.Repo.stop/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="stream/2">
    <span id="stream/1"></span>
  <div class="detail-header">
    <a href="#stream/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">stream(queryable, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Returns a lazy enumerable that emits all entries from the data store
matching the given query.</p>
<p>SQL adapters, such as Postgres and MySQL, can only enumerate a stream
inside a transaction.</p>
<p>May raise <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.QueryError.html"><code class="inline">Ecto.QueryError</code></a> if query validation fails.</p>
<h2 id="stream/2-options" class="section-heading">
  <a href="#stream/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><p><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This will be applied to all <code class="inline">from</code>
and <code class="inline">join</code>s in the query that did not have a prefix previously given
either via the <code class="inline">:prefix</code> option on <code class="inline">join</code>/<code class="inline">from</code> or via <code class="inline">@schema_prefix</code>
in the schema. For more information see the &quot;Query Prefix&quot; section of the
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html"><code class="inline">Ecto.Query</code></a> documentation.</p>
</li>
<li><p><code class="inline">:max_rows</code> - The number of rows to load from the database as we stream.
It is supported at least by Postgres and MySQL and defaults to 500.</p>
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="stream/2-example" class="section-heading">
  <a href="#stream/2-example" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Example
</h2>

<pre><code class="nohighlight makeup elixir"><span class="c1"># Fetch all post titles</span><span class="w">
</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w">
     </span><span class="ss">select</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="w">
</span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">stream</span><span class="p" data-group-id="4509953988-1">(</span><span class="n">query</span><span class="p" data-group-id="4509953988-1">)</span><span class="w">
</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">transaction</span><span class="p" data-group-id="4509953988-2">(</span><span class="k" data-group-id="4509953988-3">fn</span><span class="p" data-group-id="4509953988-4">(</span><span class="p" data-group-id="4509953988-4">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="nc">Enum</span><span class="o">.</span><span class="n">to_list</span><span class="p" data-group-id="4509953988-5">(</span><span class="n">stream</span><span class="p" data-group-id="4509953988-5">)</span><span class="w">
</span><span class="k" data-group-id="4509953988-3">end</span><span class="p" data-group-id="4509953988-2">)</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:stream/2"><code class="inline">Ecto.Repo.stream/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="to_sql/2">
  <div class="detail-header">
    <a href="#to_sql/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">to_sql(operation, queryable)</h1>
  </div>
  <section class="docstring">
<p>A convenience function for SQL-based repositories that translates the given query to SQL.</p>
<p>See <a href="https://hexdocs.pm/ecto_sql/3.2.1/Ecto.Adapters.SQL.html#to_sql/3"><code class="inline">Ecto.Adapters.SQL.to_sql/3</code></a> for more information.</p>
  </section>
</section>
<section class="detail" id="transaction/2">
    <span id="transaction/1"></span>
  <div class="detail-header">
    <a href="#transaction/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">transaction(fun_or_multi, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Runs the given function or <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Multi.html"><code class="inline">Ecto.Multi</code></a> inside a transaction.</p>
<h2 id="transaction/2-use-with-function" class="section-heading">
  <a href="#transaction/2-use-with-function" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Use with function
</h2>

<p><code class="inline">c:transaction/2</code> can be called with both a function of arity
zero or one. The arity zero function will just be executed as is,
while the arity one function will receive the repo of the transaction
as its first argument, similar to <code class="inline">Ecto.Multi.run</code>.</p>
<p>If an unhandled error occurs the transaction will be rolled back
and the error will bubble up from the transaction function.
If no error occurred the transaction will be committed when the
function returns. A transaction can be explicitly rolled back
by calling <code class="inline">c:rollback/1</code>, this will immediately leave the function
and return the value given to <code class="inline">rollback</code> as <code class="inline">{:error, value}</code>.</p>
<p>A successful transaction returns the value returned by the function
wrapped in a tuple as <code class="inline">{:ok, value}</code>.</p>
<p>If <code class="inline">c:transaction/2</code> is called inside another transaction, the function
is simply executed, without wrapping the new transaction call in any
way. If there is an error in the inner transaction and the error is
rescued, or the inner transaction is rolled back, the whole outer
transaction is marked as tainted, guaranteeing nothing will be committed.</p>
<h2 id="transaction/2-use-with-ecto-multi" class="section-heading">
  <a href="#transaction/2-use-with-ecto-multi" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Use with Ecto.Multi
</h2>

<p>Besides functions transaction can be used with an Ecto.Multi struct.
Transaction will be started, all operations applied and in case of
success committed returning <code class="inline">{:ok, changes}</code>. In case of any errors
the transaction will be rolled back and
<code class="inline">{:error, failed_operation, failed_value, changes_so_far}</code> will be
returned.</p>
<p>You can read more about using transactions with <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Multi.html"><code class="inline">Ecto.Multi</code></a> as well as
see some examples in the <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Multi.html"><code class="inline">Ecto.Multi</code></a> documentation.</p>
<h2 id="transaction/2-options" class="section-heading">
  <a href="#transaction/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="transaction/2-examples" class="section-heading">
  <a href="#transaction/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="kn">import</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="p">,</span><span class="w"> </span><span class="ss">only</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5205512350-1">[</span><span class="ss">change</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="5205512350-1">]</span><span class="w">

</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">transaction</span><span class="p" data-group-id="5205512350-2">(</span><span class="k" data-group-id="5205512350-3">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="5205512350-4">(</span><span class="n">change</span><span class="p" data-group-id="5205512350-5">(</span><span class="n">alice</span><span class="p">,</span><span class="w"> </span><span class="ss">balance</span><span class="p">:</span><span class="w"> </span><span class="n">alice</span><span class="o">.</span><span class="n">balance</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="5205512350-5">)</span><span class="p" data-group-id="5205512350-4">)</span><span class="w">
  </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="5205512350-6">(</span><span class="n">change</span><span class="p" data-group-id="5205512350-7">(</span><span class="n">bob</span><span class="p">,</span><span class="w"> </span><span class="ss">balance</span><span class="p">:</span><span class="w"> </span><span class="n">bob</span><span class="o">.</span><span class="n">balance</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="5205512350-7">)</span><span class="p" data-group-id="5205512350-6">)</span><span class="w">
</span><span class="k" data-group-id="5205512350-3">end</span><span class="p" data-group-id="5205512350-2">)</span><span class="w">

</span><span class="c1"># When passing a function of arity 1, it receives the repository itself</span><span class="w">
</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">transaction</span><span class="p" data-group-id="5205512350-8">(</span><span class="k" data-group-id="5205512350-9">fn</span><span class="w"> </span><span class="n">repo</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
  </span><span class="n">repo</span><span class="o">.</span><span class="n">insert!</span><span class="p" data-group-id="5205512350-10">(</span><span class="p" data-group-id="5205512350-11">%</span><span class="nc" data-group-id="5205512350-11">Post</span><span class="p" data-group-id="5205512350-11">{</span><span class="p" data-group-id="5205512350-11">}</span><span class="p" data-group-id="5205512350-10">)</span><span class="w">
</span><span class="k" data-group-id="5205512350-9">end</span><span class="p" data-group-id="5205512350-8">)</span><span class="w">

</span><span class="c1"># Roll back a transaction explicitly</span><span class="w">
</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">transaction</span><span class="p" data-group-id="5205512350-12">(</span><span class="k" data-group-id="5205512350-13">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">insert!</span><span class="p" data-group-id="5205512350-14">(</span><span class="p" data-group-id="5205512350-15">%</span><span class="nc" data-group-id="5205512350-15">Post</span><span class="p" data-group-id="5205512350-15">{</span><span class="p" data-group-id="5205512350-15">}</span><span class="p" data-group-id="5205512350-14">)</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nc">Editor</span><span class="o">.</span><span class="n">post_allowed?</span><span class="p" data-group-id="5205512350-16">(</span><span class="n">p</span><span class="p" data-group-id="5205512350-16">)</span><span class="w"> </span><span class="k" data-group-id="5205512350-17">do</span><span class="w">
    </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">rollback</span><span class="p" data-group-id="5205512350-18">(</span><span class="ss">:posting_not_allowed</span><span class="p" data-group-id="5205512350-18">)</span><span class="w">
  </span><span class="k" data-group-id="5205512350-17">end</span><span class="w">
</span><span class="k" data-group-id="5205512350-13">end</span><span class="p" data-group-id="5205512350-12">)</span><span class="w">

</span><span class="c1"># With Ecto.Multi</span><span class="w">
</span><span class="nc">Ecto.Multi</span><span class="o">.</span><span class="n">new</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ecto.Multi</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="5205512350-19">(</span><span class="ss">:post</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5205512350-20">%</span><span class="nc" data-group-id="5205512350-20">Post</span><span class="p" data-group-id="5205512350-20">{</span><span class="p" data-group-id="5205512350-20">}</span><span class="p" data-group-id="5205512350-19">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">transaction</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:transaction/2"><code class="inline">Ecto.Repo.transaction/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="update/2">
    <span id="update/1"></span>
  <div class="detail-header">
    <a href="#update/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">update(struct, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Updates a changeset using its primary key.</p>
<p>A changeset is required as it is the only mechanism for
tracking dirty changes. Only the fields present in the <code class="inline">changes</code> part
of the changeset are sent to the database. Any other, in-memory
changes done to the schema are ignored.</p>
<p>If the struct has no primary key, <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.NoPrimaryKeyFieldError.html"><code class="inline">Ecto.NoPrimaryKeyFieldError</code></a>
will be raised.</p>
<p>If the struct cannot be found, <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.StaleEntryError.html"><code class="inline">Ecto.StaleEntryError</code></a> will be raised.</p>
<p>It returns <code class="inline">{:ok, struct}</code> if the struct has been successfully
updated or <code class="inline">{:error, changeset}</code> if there was a validation
or a known constraint error.</p>
<h2 id="update/2-options" class="section-heading">
  <a href="#update/2-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:returning</code> - selects which fields to return. It accepts a list
of fields to be returned from the database. When <code class="inline">true</code>, returns
all fields. When <code class="inline">false</code>, no extra fields are returned. It will
always include all fields in <code class="inline">read_after_writes</code>. Not all
databases support this option.
</li>
<li><code class="inline">:force</code> - By default, if there are no changes in the changeset,
<code class="inline">c:update/2</code> is a no-op. By setting this option to true, update
callbacks will always be executed, even if there are no changes
(including timestamps).
</li>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This overrides the prefix set
in the query and any <code class="inline">@schema_prefix</code> set any schemas. Also, the
<code class="inline">@schema_prefix</code> for the parent record will override all default
<code class="inline">@schema_prefix</code>s set in any child schemas for associations.
</li>
<li><code class="inline">:stale_error_field</code> - The field where stale errors will be added in
the returning changeset. This option can be used to avoid raising
<a href="https://hexdocs.pm/ecto/3.2.5/Ecto.StaleEntryError.html"><code class="inline">Ecto.StaleEntryError</code></a>.
</li>
<li><code class="inline">:stale_error_message</code> - The message to add to the configured
<code class="inline">:stale_error_field</code> when stale errors happen, defaults to &quot;is stale&quot;.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for more options.</p>
<h2 id="update/2-example" class="section-heading">
  <a href="#update/2-example" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Example
</h2>

<pre><code class="nohighlight makeup elixir"><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="7225937255-1">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p" data-group-id="7225937255-1">)</span><span class="w">
</span><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">change</span><span class="w"> </span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;New title&quot;</span><span class="w">
</span><span class="k">case</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">update</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="k" data-group-id="7225937255-2">do</span><span class="w">
  </span><span class="p" data-group-id="7225937255-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">struct</span><span class="p" data-group-id="7225937255-3">}</span><span class="w">       </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1"># Updated with success</span><span class="w">
  </span><span class="p" data-group-id="7225937255-4">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">changeset</span><span class="p" data-group-id="7225937255-4">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1"># Something went wrong</span><span class="w">
</span><span class="k" data-group-id="7225937255-2">end</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:update/2"><code class="inline">Ecto.Repo.update/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="update!/2">
    <span id="update!/1"></span>
  <div class="detail-header">
    <a href="#update!/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">update!(struct, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Same as <code class="inline">c:update/2</code> but returns the struct or raises if the changeset is invalid.</p>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:update!/2"><code class="inline">Ecto.Repo.update!/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="update_all/3">
    <span id="update_all/2"></span>
  <div class="detail-header">
    <a href="#update_all/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">update_all(queryable, updates, opts \\ [])</h1>
  </div>
  <section class="docstring">
<p>Updates all entries matching the given query with the given values.</p>
<p>It returns a tuple containing the number of entries and any returned
result as second element. The second element is <code class="inline">nil</code> by default
unless a <code class="inline">select</code> is supplied in the update query. Note, however,
not all databases support returning data from UPDATEs.</p>
<p>Keep in mind this <code class="inline">update_all</code> will not update autogenerated
fields like the <code class="inline">updated_at</code> columns.</p>
<p>See <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Query.html#update/3"><code class="inline">Ecto.Query.update/3</code></a> for update operations that can be
performed on fields.</p>
<h2 id="update_all/3-options" class="section-heading">
  <a href="#update_all/3-options" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Options
</h2>

<ul>
<li><code class="inline">:prefix</code> - The prefix to run the query on (such as the schema path
in Postgres or the database in MySQL). This overrides the prefix set
in the query and any <code class="inline">@schema_prefix</code> set in the schema.
</li>
</ul>
<p>See the &quot;Shared options&quot; section at the module documentation for
remaining options.</p>
<h2 id="update_all/3-examples" class="section-heading">
  <a href="#update_all/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="nc">MyRepo</span><span class="o">.</span><span class="n">update_all</span><span class="p" data-group-id="1831844786-1">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">set</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1831844786-2">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;New title&quot;</span><span class="p" data-group-id="1831844786-2">]</span><span class="p" data-group-id="1831844786-1">)</span><span class="w">

</span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">update_all</span><span class="p" data-group-id="1831844786-3">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">inc</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1831844786-4">[</span><span class="ss">visits</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="1831844786-4">]</span><span class="p" data-group-id="1831844786-3">)</span><span class="w">

</span><span class="n">from</span><span class="p" data-group-id="1831844786-5">(</span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">where</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="ss">select</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">visits</span><span class="p" data-group-id="1831844786-5">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">update_all</span><span class="p" data-group-id="1831844786-6">(</span><span class="ss">set</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1831844786-7">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;New title&quot;</span><span class="p" data-group-id="1831844786-7">]</span><span class="p" data-group-id="1831844786-6">)</span><span class="w">

</span><span class="n">from</span><span class="p" data-group-id="1831844786-8">(</span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">where</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="ss">update</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1831844786-9">[</span><span class="ss">set</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1831844786-10">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;New title&quot;</span><span class="p" data-group-id="1831844786-10">]</span><span class="p" data-group-id="1831844786-9">]</span><span class="p" data-group-id="1831844786-8">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">update_all</span><span class="p" data-group-id="1831844786-11">(</span><span class="p" data-group-id="1831844786-12">[</span><span class="p" data-group-id="1831844786-12">]</span><span class="p" data-group-id="1831844786-11">)</span><span class="w">

</span><span class="n">from</span><span class="p" data-group-id="1831844786-13">(</span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">where</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="ss">update</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1831844786-14">[</span><span class="ss">set</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1831844786-15">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="o">^</span><span class="n">new_title</span><span class="p" data-group-id="1831844786-15">]</span><span class="p" data-group-id="1831844786-14">]</span><span class="p" data-group-id="1831844786-13">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">update_all</span><span class="p" data-group-id="1831844786-16">(</span><span class="p" data-group-id="1831844786-17">[</span><span class="p" data-group-id="1831844786-17">]</span><span class="p" data-group-id="1831844786-16">)</span><span class="w">

</span><span class="n">from</span><span class="p" data-group-id="1831844786-18">(</span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">where</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="ss">update</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1831844786-19">[</span><span class="ss">set</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1831844786-20">[</span><span class="ss">title</span><span class="p">:</span><span class="w"> </span><span class="n">fragment</span><span class="p" data-group-id="1831844786-21">(</span><span class="s">&quot;upper(?)&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">^</span><span class="n">new_title</span><span class="p" data-group-id="1831844786-21">)</span><span class="p" data-group-id="1831844786-20">]</span><span class="p" data-group-id="1831844786-19">]</span><span class="p" data-group-id="1831844786-18">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">MyRepo</span><span class="o">.</span><span class="n">update_all</span><span class="p" data-group-id="1831844786-22">(</span><span class="p" data-group-id="1831844786-23">[</span><span class="p" data-group-id="1831844786-23">]</span><span class="p" data-group-id="1831844786-22">)</span></code></pre>
<p>Callback implementation for <a href="https://hexdocs.pm/ecto/3.2.5/Ecto.Repo.html#c:update_all/3"><code class="inline">Ecto.Repo.update_all/3</code></a>.</p>
  </section>
</section>
          </div>
        </section>
      <footer class="footer">
        <p>
          <span class="line">
            Built using
            <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener">ExDoc</a> (v0.21.2),
          </span>
          <span class="line">
            designed by
            <a href="https://twitter.com/dignifiedquire" target="_blank" rel="noopener" title="@dignifiedquire">Friedel Ziegelmayer</a>.
          </span>
        </p>
        <p>
          <button class="line footer-button night-mode-toggle">
            Toggle night mode
          </button>
          <button class="line footer-button tooltips-toggle">
            <span class="tooltips-option-disable">Disable tooltips</span>
            <span class="tooltips-option-enable">Enable tooltips</span>
          </button>
          <button class="line footer-button display-shortcuts-help">
            Display keyboard shortcuts
          </button>
          <button class="line footer-button display-quick-switch">
            Go to a HexDocs package
          </button>
        </p>
      </footer>
    </div>
  </div>
</section>
</div>
  </body>
</html>
